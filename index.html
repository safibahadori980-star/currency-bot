<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>NERKHYAB PRO</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://unpkg.com/jalaali-js/dist/jalaali.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">

<style>
:root{
 --bg:#000;
 --card:rgba(255,255,255,.08);
 --text:#fff;
 --border:rgba(255,255,255,.1);
 --nav:rgba(28,28,30,.9);
}
body.light{
 --bg:#f2f2f7;
 --card:rgba(0,0,0,.05);
 --text:#000;
 --border:rgba(0,0,0,.1);
 --nav:rgba(255,255,255,.9);
}
body{
 margin:0;
 font-family:'Vazirmatn',sans-serif;
 background:var(--bg);
 color:var(--text);
 transition:.3s;
}
.header{
 height:80px;
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:0 20px;
 border-bottom:1px solid var(--border);
}
.logo{width:55px;border-radius:12px}
.date{text-align:center;font-weight:bold}
.container{padding:15px 20px 100px;display:flex;flex-direction:column;gap:12px}
.card{
 background:var(--card);
 backdrop-filter:blur(15px);
 border:1px solid var(--border);
 border-radius:20px;
 padding:16px 18px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 cursor:pointer;
 transition:.2s;
}
.card:hover{transform:scale(1.02)}
.card.up{border-right:5px solid #32d74b}
.card.down{border-right:5px solid #ff453a}
.price{font-size:1.8rem;font-weight:900;font-family:sans-serif}
.sub{font-size:.75rem;opacity:.6}
.percent{font-weight:bold;font-size:.85rem}
.bottom{
 position:fixed;
 bottom:15px;
 left:50%;
 transform:translateX(-50%);
 width:85%;
 background:var(--nav);
 backdrop-filter:blur(20px);
 border-radius:30px;
 padding:12px 20px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 border:1px solid var(--border);
}
.modal{
 position:fixed;
 inset:0;
 background:var(--bg);
 display:none;
 flex-direction:column;
 padding:25px;
 z-index:1000;
}
.modal.active{display:flex}
.chart-box{
 height:260px;
 background:var(--card);
 border-radius:20px;
 padding:15px;
 margin-top:20px;
}
.skeleton{
 height:75px;
 border-radius:20px;
 background:linear-gradient(90deg,#222,#333,#222);
 animation:load 1.2s infinite;
}
@keyframes load{
 0%{background-position:-200px 0}
 100%{background-position:200px 0}
}
.fade{
 animation:fade .3s ease;
}
@keyframes fade{
 from{opacity:0;transform:translateY(5px)}
 to{opacity:1;transform:none}
}
.error{
 text-align:center;
 opacity:.6;
 margin-top:40px;
}
</style>
</head>
<body>

<div class="header">
 <img src="logo.png" class="logo" onerror="this.src='https://img.icons8.com/fluency/96/money-box.png'">
 <div class="date" id="dt"></div>
 <div style="font-size:.7rem;font-weight:900">NERKHYAB<br>PRO</div>
</div>

<div id="main" class="container"></div>

<div class="bottom">
 <i class="fas fa-cog" onclick="openModal('settings')"></i>
 <b>لحظاتی پیش</b>
 <i class="fas fa-moon" id="themeIcon" onclick="toggleTheme()"></i>
</div>

<div id="chartModal" class="modal">
 <div style="display:flex;justify-content:space-between">
  <b id="chartTitle">نمودار</b>
  <i class="fas fa-times" onclick="closeModal('chartModal')"></i>
 </div>
 <div class="chart-box">
  <canvas id="chart"></canvas>
 </div>
</div>

<script>
function updateDT(){
 const now=new Date();
 const t=now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});
 const j=jalaali.toJalaali(now);
 document.getElementById('dt').innerHTML=`${t}<div style="font-size:.8rem;opacity:.7">${j.jy}/${j.jm}/${j.jd}</div>`;
}
setInterval(updateDT,1000);updateDT();

function toggleTheme(){
 document.body.classList.toggle('light');
 document.getElementById('themeIcon').className=
 document.body.classList.contains('light')?'fas fa-sun':'fas fa-moon';
}

function openModal(id){document.getElementById(id).classList.add('active')}
function closeModal(id){document.getElementById(id).classList.remove('active')}

const config=[
 {key:"دالر هرات",sub:"USD/AFN"},
 {key:"یورو هرات",sub:"EUR/AFN"},
 {key:"تومان چک",sub:"IRT/AFN"},
 {key:"تومان بانکی",sub:"IRR/AFN"},
 {key:"کلدار",sub:"PKR/AFN"}
];

let chartInstance=null;

function showChart(name,value,status){
 openModal('chartModal');
 document.getElementById('chartTitle').innerText=`نوسانات ${name}`;
 const ctx=document.getElementById('chart').getContext('2d');
 if(chartInstance)chartInstance.destroy();
 const val=parseFloat(String(value).replace(/,/g,''));
 const color=status==="down"?"#ff453a":"#32d74b";
 chartInstance=new Chart(ctx,{
  type:'line',
  data:{
   labels:['09','11','13','15','17'],
   datasets:[{
    data:[val*0.995,val*1.003,val*0.998,val*1.006,val],
    borderColor:color,
    borderWidth:3,
    tension:.4,
    fill:true,
    backgroundColor:color+'22',
    pointRadius:0
   }]
  },
  options:{
   responsive:true,
   maintainAspectRatio:false,
   plugins:{legend:{display:false}},
   scales:{x:{grid:{display:false}},y:{display:false}}
  }
 });
}

function showSkeleton(){
 const main=document.getElementById('main');
 main.innerHTML='';
 for(let i=0;i<5;i++){
  const s=document.createElement('div');
  s.className='skeleton';
  main.appendChild(s);
 }
}

async function loadRates(){
 showSkeleton();
 try{
  const res=await fetch('last_rates.json?v='+Date.now());
  if(!res.ok)throw new Error();
  const data=await res.json();
  const main=document.getElementById('main');
  main.innerHTML='';
  config.forEach(item=>{
   const r=data.rates[item.key]||{current:"---",status:"same",percent:"0%"};
   const card=document.createElement('div');
   card.className=`card ${r.status} fade`;
   card.onclick=()=>showChart(item.key,r.current,r.status);

   const color=
    r.status==="up"?"#32d74b":
    r.status==="down"?"#ff453a":"#aaa";

   if(r.status==="up"||r.status==="down")navigator.vibrate?.(50);

   card.innerHTML=`
    <div class="price">${r.current}</div>
    <div style="text-align:right">
     <div style="display:flex;gap:6px;align-items:center;justify-content:flex-end">
      <span class="percent" style="color:${color}">${r.percent}</span>
      <b>${item.key}</b>
     </div>
     <div class="sub">${item.sub}</div>
    </div>
   `;
   main.appendChild(card);
  });
 }catch(e){
  document.getElementById('main').innerHTML=
  `<div class="error">اتصال برقرار نیست</div>`;
 }
}

loadRates();
setInterval(loadRates,30000);
</script>
<div id="settings" class="modal">
  <div style="display:flex;justify-content:space-between;margin-bottom:25px">
    <b>تنظیمات</b>
    <i class="fas fa-times" onclick="closeModal('settings')"></i>
  </div>

  <button onclick="loadRates()" 
    style="padding:12px;border-radius:12px;border:1px solid var(--border);
    background:var(--card);color:var(--text);width:100%;margin-bottom:12px">
    بروزرسانی دستی
  </button>

  <button onclick="alert('NERKHYAB PRO\nDeveloped by Safi');" 
    style="padding:12px;border-radius:12px;border:1px solid var(--border);
    background:var(--card);color:var(--text);width:100%;margin-bottom:12px">
    درباره برنامه
  </button>

  <a href="https://www.instagram.com/safi.tech.ai" target="_blank"
     style="display:block;text-align:center;padding:14px;border-radius:15px;
     background:linear-gradient(45deg,#f09433,#dc2743,#bc1888);
     color:#fff;font-weight:bold;text-decoration:none;margin-top:20px">
     Developer
  </a>
</div>
</body>
    </html>
