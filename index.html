<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NERKHYAB PRO</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/jalaali-js/dist/jalaali.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">

    <style>
        :root {
            --bg:#000;
            --card:rgba(255,255,255,0.08);
            --text:#fff;
            --border:rgba(255,255,255,0.1);
            --nav:rgba(28,28,30,0.9);
            --green: #00c853;
            --red: #ff5252;
        }

        body.light-mode {
            --bg:#f2f2f7;
            --card:rgba(0,0,0,0.05);
            --text:#000;
            --border:rgba(0,0,0,0.1);
            --nav:rgba(255,255,255,0.9);
        }

        body {
            margin:0;
            background:var(--bg);
            color:var(--text);
            font-family:'Vazirmatn', sans-serif;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* HEADER - فیکس شده در یک خط */
        .header { 
            padding: 10px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            height: 70px; 
            border-bottom: 1px solid var(--border); 
            background: var(--bg);
        }

        .main-logo { width:50px; border-radius:12px; }

        .date-time { 
            display: flex; 
            flex-direction: row-reverse; 
            align-items: center;
            gap: 10px; 
            white-space: nowrap; 
        }

        .date-time b { font-size: 1.2rem; font-weight: 900; }
        .date-time span { font-size: 0.95rem; opacity: 0.8; }

        /* CARDS - با حاشیه رنگی فعال */
        .container {
            padding:15px 20px 100px;
            display:flex;
            flex-direction:column;
            gap:12px;
        }

        .card {
            background:var(--card);
            backdrop-filter:blur(15px);
            border:1px solid var(--border);
            border-radius:20px;
            padding:14px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            transition: all 0.3s ease;
        }

        /* اعمال حاشیه سبز برای صعودی */
        .card.up {
            border-left: 5px solid var(--green) !important;
            border-bottom: 3px solid var(--green) !important;
        }
        .card.up .price-val { color: var(--green); }

        /* اعمال حاشیه قرمز برای نزولی */
        .card.down {
            border-left: 5px solid var(--red) !important;
            border-bottom: 3px solid var(--red) !important;
        }
        .card.down .price-val { color: var(--red); }

        .price-box { display:flex; flex-direction:column; gap:5px; }

        .status-badge {
            display:flex;
            align-items:center;
            gap:5px;
            padding:3px 8px;
            border-radius:50px;
            font-size:0.75rem;
            font-weight:bold;
            direction:ltr;
        }

        .arrow-circle {
            width:16px; height:16px; border-radius:50%;
            display:flex; align-items:center; justify-content:center; font-size:0.6rem;
        }

        .up .status-badge {color:var(--green); background:rgba(0,200,83,0.15);}
        .up .arrow-circle {background:var(--green); color:#000;}

        .down .status-badge {color:var(--red); background:rgba(255,82,82,0.15);}
        .down .arrow-circle {background:var(--red); color:#fff;}

        .same .status-badge {color:#aaa; background:rgba(142,142,147,0.1);}
        .same .arrow-circle {background:#aaa; color:#fff;}

        .price-val { font-size:1.9rem; font-weight:900; }

        .card-info { display:flex; align-items:center; gap:12px; }
        .market-closed { color: #ff9f0a; font-size: 0.6rem; font-weight: 300; margin-top: 2px; }

        /* NAV */
        .bottom-nav {
            position:fixed;
            bottom:15px; left:50%; transform:translateX(-50%);
            width:85%; background:var(--nav);
            backdrop-filter:blur(20px); border-radius:30px;
            padding:12px 20px; display:flex;
            justify-content:space-between; align-items:center;
            border:1px solid var(--border); z-index: 1000;
        }

        /* MODAL */
        .full-modal {
            position:fixed; inset:0; background:var(--bg);
            display:none; z-index:2000; padding:25px;
            flex-direction:column;
        }
        .full-modal.active {display:flex;}
        .setting-btn {
            padding:15px; border-radius:12px; border:1px solid var(--border);
            background:var(--card); color:var(--text); margin-bottom:10px; font-weight: bold;
        }
        /* استایل دکمه لغزنده */
.switch-wrapper {
    display: flex; justify-content: space-between; align-items: center;
    background: var(--card); padding: 15px; border-radius: 15px;
    margin-bottom: 15px; border: 1px solid var(--border);
}
.switch { position: relative; display: inline-block; width: 44px; height: 22px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; inset: 0; background-color: #444; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--green); }
input:checked + .slider:before { transform: translateX(22px); }

/* تغییر چیدمان به حالت جدولی */
.container.grid-mode {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}
.grid-mode .card {
    flex-direction: column-reverse;
    text-align: center;
    padding: 12px 10px;
    gap: 8px;
}
.grid-mode .card-info { flex-direction: column-reverse; gap: 5px; }
.grid-mode .price-val { font-size: 1.5rem; }
.grid-mode .status-badge { justify-content: center; }
    </style>
</head>

<body>

    <div class="header">
        <img src="logo.png" class="main-logo" onerror="this.src='https://img.icons8.com/fluency/96/money-box.png'">
        <div class="date-time" id="dt"></div>
        <div style="font-weight:900; line-height: 1.2; font-size: 0.8rem; text-align: left;">NERKHYAB<br>PRO</div>
    </div>

    <div id="main-container" class="container"></div>

    <div class="bottom-nav">
        <i class="fas fa-cog" style="cursor:pointer;" onclick="openModal('sMod')"></i>
        <span id="update-text" style="font-weight: 800; color: #d4af37;">لحظاتی پیش</span>
        <i class="fas fa-moon" style="cursor:pointer;" onclick="toggleTheme()"></i>
    </div>

    <div id="sMod" class="full-modal">
        <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom: 30px;">
            <b style="font-size: 1.3rem;">تنظیمات</b>
            <i class="fas fa-times" style="font-size: 1.5rem; cursor:pointer;" onclick="closeModal('sMod')"></i>
        </div>
        <div class="switch-wrapper">
    <span style="font-weight: bold;">نمایش دو ستونه (جدولی)</span>
    <label class="switch">
        <input type="checkbox" id="layoutToggle" onclick="toggleLayout()">
        <span class="slider"></span>
    </label>
        </div>
        <button class="setting-btn" onclick="location.reload()">بروزرسانی دستی</button>
    </div>

    <script>
        function updateDT() {
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            const timeStr = hh + ":" + mm;
            const j = jalaali.toJalaali(now);
            const dateStr = `${j.jy}/${j.jm}/${j.jd}`;
            document.getElementById('dt').innerHTML = `<b>${timeStr}</b> <span>${dateStr}</span>`;
        }
        updateDT();
        setInterval(updateDT, 1000);

        const config = [
            {key:"دالر هرات",sub:"USD/AFN",icon:"https://flagcdn.com/w160/us.png"},
            {key:"یورو هرات",sub:"EUR/AFN",icon:"https://flagcdn.com/w160/eu.png"},
            {key:"تومان چک",sub:"IRT/AFN",icon:"https://flagcdn.com/w160/ir.png"},
            {key:"تومان بانکی",sub:"IRR/AFN",icon:"https://img.icons8.com/fluency/48/bank-card-back-side.png"},
            {key:"کلدار",sub:"PKR/AFN",icon:"https://flagcdn.com/w160/pk.png"}
        ];

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function toggleTheme() { document.body.classList.toggle('light-mode'); }

        async function load() {
            try {
                const res = await fetch('last_rates.json?v=' + Date.now());
                const data = await res.json();
                render(data);
            } catch (e) {
                // نمایش دیتای پیش‌فرض در صورت نبود فایل
                render({rates: {"دالر هرات":{current:"---",status:"same",percent:"0%"}}});
            }
        }

        function render(data) {
            const container = document.getElementById('main-container');
            container.innerHTML = '';
            const isClosed = new Date().getHours() >= 17;

            config.forEach(item => {
                const r = data.rates[item.key] || {current: "---", status: "same", percent: "0%"};
                const arrow = r.status === 'up' ? 'fa-arrow-up' : r.status === 'down' ? 'fa-arrow-down' : 'fa-minus';
                
                const card = document.createElement('div');
                card.className = `card ${r.status}`; // اینجا کلاس up یا down اضافه می‌شود

                card.innerHTML = `
                    <div class="price-box">
                        <div class="status-badge">
                            <span>${r.percent}</span>
                            <div class="arrow-circle"><i class="fas ${arrow}"></i></div>
                        </div>
                        <div class="price-val">${r.current}</div>
                    </div>
                    <div class="card-info">
                        <div style="text-align:right;">
                            <b>${item.key}</b>
                            <div style="font-size:0.75rem;opacity:0.6;">${item.sub}</div>
                            ${isClosed ? '<div class="market-closed"> ( پایان معاملات امروز )</div>' : ''}
                        </div>
                        <img src="${item.icon}" style="width:40px;height:40px;border-radius:10px;object-fit:cover;">
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleLayout() {
    const container = document.getElementById('main-container');
    const isGrid = container.classList.toggle('grid-mode');
    // این خط باعث ذخیره شدن وضعیت می‌شود
    localStorage.setItem('isGridMode', isGrid);
}

// این بخش را هم دقیقاً زیر تابع بالا اضافه کن تا هنگام رفرش، وضعیت را از حافظه بخواند
window.addEventListener('DOMContentLoaded', () => {
    const isGrid = localStorage.getItem('isGridMode') === 'true';
    if (isGrid) {
        document.getElementById('main-container').classList.add('grid-mode');
        const toggleInput = document.getElementById('layoutToggle');
        if (toggleInput) toggleInput.checked = true;
    }
});
        load();
setInterval(load, 30000);
    </script>
</body>
</html>
