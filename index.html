<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NERKHYAB KHORASAN</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/jalaali-js/dist/jalaali.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        :root { --bg: #000; --card: #1c1c1e; --text: #fff; --sub: #8e8e93; --accent: #32d74b; --down: #ff453a; --modal: rgba(20, 20, 22, 0.98); }
        .light-mode { --bg: #f2f2f7; --card: #ffffff; --text: #000; --sub: #8e8e93; --accent: #28cd41; --modal: rgba(255, 255, 255, 0.98); }
        
        body { background: var(--bg); color: var(--text); font-family: 'Vazirmatn', sans-serif; margin: 0; transition: 0.3s; overflow-x: hidden; }

        /* Top Bar */
        .top-bar { padding: 45px 25px 15px 25px; display: flex; justify-content: space-between; align-items: flex-start; }
        .logo-text { font-size: 2.2rem; font-weight: 900; letter-spacing: -1.5px; margin: 0; line-height: 1; }
        .sub-logo { display: block; font-size: 0.85rem; font-weight: 600; letter-spacing: 5px; color: #ffffff; margin-top: 2px; opacity: 0.9; }
        .date-time { text-align: left; font-size: 0.9rem; font-weight: bold; opacity: 0.8; }

        /* Container & Cards */
        .container { padding: 15px; display: grid; gap: 12px; margin-bottom: 100px; }
        .grid-view { grid-template-columns: 1fr 1fr; }
        .list-view { grid-template-columns: 1fr; }
        
        .card { background: var(--card); border-radius: 26px; padding: 18px; height: 135px; display: flex; flex-direction: column; justify-content: space-between; transition: 0.2s; cursor: pointer; }
        .card:active { transform: scale(0.96); opacity: 0.8; }
        .circle-icon { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; background: #2c2c2e; overflow: hidden; }
        .circle-icon img { width: 100%; height: 100%; object-fit: cover; }

        /* Detailed Price Modal (Necha Style) */
        .detail-modal { position: fixed; inset: 0; background: var(--modal); backdrop-filter: blur(20px); display: none; z-index: 2000; padding: 30px; flex-direction: column; animation: fadeIn 0.3s; }
        .detail-modal.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .price-large { font-size: 3.5rem; font-weight: 900; margin: 10px 0; }
        .stat-row { display: flex; justify-content: space-between; margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }

        /* Settings Modal */
        .settings-modal { position: fixed; inset: 0; background: var(--modal); backdrop-filter: blur(25px); display: none; flex-direction: column; padding: 30px; z-index: 1000; border-radius: 35px 35px 0 0; margin-top: 80px; overflow-y: auto; }
        .settings-modal.active { display: flex; animation: slideUp 0.4s; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .toggle-group { display: flex; background: rgba(120,120,128,0.2); border-radius: 12px; padding: 3px; margin: 8px 0 20px 0; }
        .toggle-btn { flex: 1; border: none; background: none; color: var(--text); padding: 10px; border-radius: 10px; font-family: 'Vazirmatn'; font-size: 0.85rem; }
        .toggle-btn.active { background: #636366; color: #fff; }

        .bottom-nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; background: rgba(44,44,46,0.8); backdrop-filter: blur(20px); border-radius: 30px; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
    </style>
</head>
<body class="dark-mode">

    <div class="top-bar">
        <div><h1 class="logo-text">NERKHYAB</h1><span class="sub-logo">KHORASAN</span></div>
        <div class="date-time" id="dt">----/--/--<br>--:--</div>
    </div>

    <div id="main-container" class="container grid-view"></div>

    <div class="detail-modal" id="dMod">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="display:flex; align-items:center; gap:15px;">
                <div id="detIcon" class="circle-icon" style="width:60px; height:60px;"></div>
                <div><b id="detTitle" style="font-size:1.5rem;">---</b><br><span id="detSub" style="color:var(--sub)">---</span></div>
            </div>
            <i class="fas fa-times" style="font-size:1.8rem; opacity:0.6" onclick="closeDetail()"></i>
        </div>
        <div id="detChange" style="margin-top:30px; font-weight:bold; font-size:1.2rem;">---</div>
        <div class="price-large" id="detPrice">---</div>
        
        <div class="stat-row">
            <div><span style="color:var(--sub)">کف:</span> <b id="detLow">---</b></div>
            <div><span style="color:var(--sub)">سقف:</span> <b id="detHigh">---</b></div>
        </div>
        
        <div style="margin-top:40px; height:150px; background:rgba(50,215,75,0.05); border-radius:20px; display:flex; align-items:center; justify-content:center; border: 1px dashed rgba(255,255,255,0.1)">
            <span style="color:var(--accent); font-size:0.9rem;">نمودار نوسان ۲۴ ساعته</span>
        </div>
    </div>

    <div class="bottom-nav">
        <i class="fas fa-plus" style="opacity:0.2"></i>
        <span style="font-size:0.9rem; opacity:0.7;">بروزرسانی لحظه‌ای</span>
        <i class="fas fa-cog" onclick="toggleSettings()" style="cursor:pointer; font-size:1.3rem;"></i>
    </div>

    <div class="settings-modal" id="sMod">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <b style="font-size:1.4rem;">تنظیمات</b>
            <i class="fas fa-times" onclick="toggleSettings()"></i>
        </div>
        <label style="color:var(--sub); font-size:0.8rem;">تغییر زبان</label>
        <div class="toggle-group"><button class="toggle-btn active">فارسی</button><button class="toggle-btn">English</button></div>
        <button style="background:#007aff; color:#fff; border:none; padding:15px; border-radius:15px; width:100%; font-family:'Vazirmatn'; font-weight:bold;" onclick="alert('توسعه‌دهنده: صفی‌الله بهادری\\nمشاور: یاسر سلجوقی')">درباره برنامه</button>
    </div>

    <script>
        function toggleSettings() { document.getElementById('sMod').classList.toggle('active'); }
        function closeDetail() { document.getElementById('dMod').classList.remove('active'); }

        async function openDetail(name, sub, price, icon) {
            const isUp = Math.random() > 0.5;
            const change = (Math.random() * 2).toFixed(2);
            document.getElementById('detTitle').innerText = name;
            document.getElementById('detSub').innerText = sub;
            document.getElementById('detPrice').innerText = price;
            document.getElementById('detIcon').innerHTML = `<img src="${icon}">`;
            document.getElementById('detChange').innerHTML = `<span style="color:${isUp ? 'var(--accent)' : 'var(--down)'}">${isUp ? '↓' : '↑'} ${isUp ? '-' : '+'}${change}%</span>`;
            document.getElementById('detLow').innerText = (parseFloat(price.replace(/,/g,'')) * 0.98).toLocaleString();
            document.getElementById('detHigh').innerText = (parseFloat(price.replace(/,/g,'')) * 1.02).toLocaleString();
            document.getElementById('dMod').classList.add('active');
        }

        async function load() {
            try {
                const res = await fetch('last_rates.json?v=' + Date.now());
                const data = await res.json();
                const cont = document.getElementById('main-container');
                cont.innerHTML = '';
                const config = [
                    { key: "دالر هرات", name: "دالر", sub: "دالر هرات", icon: "https://flagcdn.com/w160/us.png" },
                    { key: "یورو هرات", name: "یورو", sub: "یورو هرات", icon: "https://flagcdn.com/w160/eu.png" },
                    { key: "تومان چک", name: "تومان", sub: "تومان چک", icon: "https://flagcdn.com/w160/ir.png" },
                    { key: "کلدار (پاکستان)", name: "کلدار", sub: "کلدار پاکستان", icon: "https://flagcdn.com/w160/pk.png" }
                ];
                config.forEach(item => {
                    const price = data.rates[item.key] || "---";
                    cont.innerHTML += `
                        <div class="card" onclick="openDetail('${item.name}', '${item.sub}', '${price}', '${item.icon}')">
                            <div style="display:flex; justify-content:space-between;">
                                <div class="circle-icon"><img src="${item.icon}"></div>
                                <div style="text-align:left"><b>${item.name}</b><br><small style="color:var(--sub)">${item.sub}</small></div>
                            </div>
                            <div style="font-size:1.7rem; font-weight:800;">${price}</div>
                        </div>`;
                });
            } catch (e) { console.error(e); }
        }
        load();
        
        function upDT() {
            const n = new Date(); const j = jalaali.toJalaali(n);
            document.getElementById('dt').innerHTML = `${j.jy}/${j.jm}/${j.jd}<br>${n.toLocaleTimeString('fa-IR', {hour:'2-digit', minute:'2-digit'})}`;
        }
        setInterval(upDT, 1000); upDT();
    </script>
</body>
                                                                                                </html>
