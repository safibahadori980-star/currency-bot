<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NERKHYAB PRO</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        :root { --bg: #000; --card: #1c1c1e; --text: #fff; --border: rgba(255,255,255,0.1); }
        body.light-mode { --bg: #f2f2f7; --card: #ffffff; --text: #000; --border: rgba(0,0,0,0.1); }
        * { font-family: 'Vazirmatn', sans-serif !important; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 0; transition: 0.3s; }
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .date-time { text-align: center; flex: 1; }
        .date-time b { font-size: 1.8rem; display: block; }
        .container { display: flex; flex-direction: column; gap: 12px; padding: 10px 20px 100px; }
        .card { 
            background: var(--card); border: 1px solid var(--border); border-radius: 20px; 
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; 
        }
        .card.up { border-right: 5px solid #32d74b; }
        .card.down { border-right: 5px solid #ff453a; }
        .price-val { font-size: 2rem; font-weight: 800; }
        .card-info { display: flex; gap: 15px; align-items: center; text-align: right; }
        .card-info img { width: 42px; height: 42px; border-radius: 8px; }
        .bottom-nav { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
            width: 85%; background: var(--card); border-radius: 30px; padding: 12px 25px; 
            display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);
        }
    </style>
</head>
<body>

    <div class="header">
        <div style="flex:1"><img src="logo.png" style="width:55px; border-radius:12px;" onerror="this.src='https://img.icons8.com/fluency/96/money-box.png'"></div>
        <div class="date-time" id="dt"></div>
        <div style="flex:1; text-align:left; font-size:0.7rem; font-weight:900; opacity:0.5;">NERKHYAB PRO</div>
    </div>

    <div id="main-container" class="container"></div>

    <div class="bottom-nav">
        <div onclick="openModal()" style="font-size:1.5rem; cursor:pointer;">‚öôÔ∏è</div>
        <span style="font-weight: 800;">ŸÜÿ±ÿÆ ŸÑÿ≠ÿ∏Ÿá‚Äåÿß€å</span>
        <div onclick="toggleTheme()" style="font-size:1.5rem; cursor:pointer;" id="themeIcon">üåô</div>
    </div>

    <script src="https://unpkg.com/jalaali-js/dist/jalaali.min.js"></script>
    <script>
        function updateDT() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
            const j = jalaali.toJalaali(now);
            document.getElementById('dt').innerHTML = `<b>AM ${timeStr}</b><span>${j.jy}/${j.jm}/${j.jd}</span>`;
        }
        setInterval(updateDT, 1000); updateDT();

        const config = [
            { key: "ÿØÿßŸÑÿ± Ÿáÿ±ÿßÿ™", name: "ÿØÿßŸÑÿ± Ÿáÿ±ÿßÿ™", sub: "USD/AFN", icon: "https://flagcdn.com/w160/us.png" },
            { key: "€åŸàÿ±Ÿà Ÿáÿ±ÿßÿ™", name: "€åŸàÿ±Ÿà Ÿáÿ±ÿßÿ™", sub: "EUR/AFN", icon: "https://flagcdn.com/w160/eu.png" },
            { key: "ÿ™ŸàŸÖÿßŸÜ ⁄Ü⁄©", name: "ÿ™ŸàŸÖÿßŸÜ ⁄Ü⁄©", sub: "IRT/AFN", icon: "https://flagcdn.com/w160/ir.png" },
            { key: "ÿ™ŸàŸÖÿßŸÜ ÿ®ÿßŸÜ⁄©€å", name: "ÿ™ŸàŸÖÿßŸÜ ÿ®ÿßŸÜ⁄©€å", sub: "IRR/AFN", icon: "https://img.icons8.com/fluency/48/bank-card-back-side.png" },
            { key: "⁄©ŸÑÿØÿßÿ±", name: "⁄©ŸÑÿØÿßÿ±", sub: "PKR/AFN", icon: "https://flagcdn.com/w160/pk.png" }
        ];

        async function load() {
            try {
                const res = await fetch('last_rates.json?v=' + Date.now());
                const data = await res.json();
                const cont = document.getElementById('main-container');
                cont.innerHTML = '';

                config.forEach(item => {
                    const r = data.rates[item.key] || {current: "---", status: "same", percent: "0.00%"};
                    
                    // ÿßÿµŸÑÿßÿ≠ ŸÜŸÖÿß€åÿ¥ ŸÅŸÑÿ¥ Ÿà ÿ±ŸÜ⁄Ø ÿ®ÿØŸàŸÜ ŸÜ€åÿßÿ≤ ÿ®Ÿá ŸÅŸàŸÜÿ™ ÿÆÿßÿ±ÿ¨€å
                    let arrow = '';
                    let color = '#aaa';
                    if (r.status === 'up') { arrow = '‚ñ≤'; color = '#32d74b'; }
                    else if (r.status === 'down') { arrow = '‚ñº'; color = '#ff453a'; }
                    else { arrow = '‚Ä¢'; color = '#aaa'; }

                    const isClosed = new Date().getHours() >= 17;
                    const closedText = isClosed ? ' <small style="color:orange;">(Closed Market)</small>' : '';

                    const card = document.createElement('div');
                    card.className = `card ${r.status}`;
                    card.innerHTML = `
                        <div class="price-val">${r.current}</div>
                        <div class="card-info">
                            <div>
                                <b>${item.name}</b>
                                <span style="color:${color}; font-weight:bold; direction:ltr; display:inline-block;">
                                    ${r.percent} ${arrow}
                                </span>
                                <div style="opacity:0.5; font-size:0.75rem;">${item.sub}${closedText}</div>
                            </div>
                            <img src="${item.icon}">
                        </div>
                    `;
                    cont.appendChild(card);
                });
            } catch(e) { console.error("Error loading rates:", e); }
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            document.getElementById('themeIcon').innerText = document.body.classList.contains('light-mode') ? '‚òÄÔ∏è' : 'üåô';
        }

        load(); setInterval(load, 30000);
    </script>
</body>
</html>
