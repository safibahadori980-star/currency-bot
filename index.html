<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>NERKHYAB PRO</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://unpkg.com/jalaali-js/dist/jalaali.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">

<style>
:root{
--bg:#000;
--card:rgba(255,255,255,0.07);
--text:#fff;
--border:rgba(255,255,255,0.1);
--nav:rgba(28,28,30,0.85);
--up:#32d74b;
--down:#ff453a;
}
body.light-mode{
--bg:#f2f2f7;
--card:rgba(0,0,0,0.05);
--text:#000;
--border:rgba(0,0,0,0.1);
--nav:rgba(255,255,255,0.85);
}
body{
margin:0;
background:var(--bg);
color:var(--text);
font-family:'Vazirmatn',sans-serif;
transition:.3s;
}

/* header */
.header{
display:flex;
justify-content:space-between;
align-items:center;
height:95px;
padding:14px 25px;
border-bottom:1px solid var(--border);
}
.main-logo{width:50px;border-radius:12px}

.date-time{
text-align:center;
}
.date-time b{
font-size:1.4rem;
display:block;
line-height:1;
}
.ampm{
font-size:.6rem;
opacity:.7;
margin-right:3px;
}
.date-line{
font-size:1rem;
opacity:.9;
margin-top:3px;
}

.brand{
font-size:.1rem;
font-weight:900;
text-align:right;
}

/* container modes */
.container{
display:grid;
gap:14px;
padding:18px 20px 120px;
transition:.3s;
}
.container.list-mode{
grid-template-columns:1fr;
}
.container.grid-mode{
grid-template-columns:repeat(2,1fr);
}

/* cards */
.card{
background:var(--card);
backdrop-filter:blur(15px);
border:1px solid var(--border);
border-radius:22px;
padding:15px;
min-height:120px;
display:flex;
flex-direction:column;
justify-content:center;
cursor:pointer;
transition:.3s;
}
.card:hover{transform:scale(1.02)}

.price-val{
font-size:2.1rem;
font-weight:850;
text-align:left;
margin-top:10px;
}

.chart-small{
height:60px;
margin-top:10px;
}

/* bottom nav */
.bottom-nav{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
width:85%;
display:flex;
justify-content:space-between;
align-items:center;
background:var(--nav);
backdrop-filter:blur(20px);
padding:14px 25px;
border-radius:30px;
border:1px solid var(--border);
z-index:1000;
}

/* modal */
.full-modal{
position:fixed;
inset:0;
background:var(--bg);
display:none;
flex-direction:column;
padding:25px;
z-index:2000;
}
.full-modal.active{display:flex}

button{
cursor:pointer;
padding:12px;
border-radius:12px;
border:1px solid var(--border);
background:var(--card);
color:var(--text);
margin-bottom:12px;
font-family:inherit;
}
</style>
</head>
<body>

<div class="header">
<div><img src="logo.png" class="main-logo"></div>
<div class="date-time" id="dt"></div>
<div class="brand">NERKHYAB<br>PRO</div>
</div>

<div id="main-container" class="container"></div>

<div class="bottom-nav">
<i class="fas fa-moon" id="themeIcon" onclick="toggleTheme()"></i>
<span>لحظاتی پیش</span>
<i class="fas fa-cog" onclick="openModal('settingsModal')"></i>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="full-modal">
<div style="display:flex;justify-content:space-between;margin-bottom:20px">
<b>تنظیمات</b>
<i class="fas fa-times" onclick="closeModal('settingsModal')"></i>
</div>

<button onclick="toggleViewMode()">تغییر حالت لیستی / جدولی</button>
<button onclick="toggleTheme()">تغییر تم روشن / تاریک</button>

</div>

<script>
const config=[
{key:"دالر هرات",sub:"USD/AFN"},
{key:"یورو هرات",sub:"EUR/AFN"},
{key:"تومان چک",sub:"IRT/AFN"},
{key:"تومان بانکی",sub:"IRR/AFN"},
{key:"کلدار",sub:"PKR/AFN"}
];

/* ساعت */
function updateDT(){
const now=new Date();
let time=now.toLocaleTimeString('en-GB',{
hour:'2-digit',
minute:'2-digit',
hour12:true
});
time=time.replace("AM","<span class='ampm'>AM</span>")
.replace("PM","<span class='ampm'>PM</span>");
const j=jalaali.toJalaali(now);
document.getElementById('dt').innerHTML=
`<b>${time}</b><div class="date-line">${j.jy}/${j.jm}/${j.jd}</div>`;
}
setInterval(updateDT,1000);
updateDT();

/* تم */
function toggleTheme(){
document.body.classList.toggle('light-mode');
localStorage.setItem('theme',
document.body.classList.contains('light-mode')?'light':'dark');
}

/* حالت نمایش */
function toggleViewMode(){
const cont=document.getElementById('main-container');
if(cont.classList.contains('grid-mode')){
cont.classList.remove('grid-mode');
cont.classList.add('list-mode');
localStorage.setItem('viewMode','list');
}else{
cont.classList.remove('list-mode');
cont.classList.add('grid-mode');
localStorage.setItem('viewMode','grid');
}
}

/* مودال */
function openModal(id){
document.getElementById(id).classList.add('active');
}
function closeModal(id){
document.getElementById(id).classList.remove('active');
}

/* بارگذاری داده */
async function load(){
try{
const res=await fetch('last_rates.json');
const data=await res.json();
const rates=data?.rates||{};
const cont=document.getElementById('main-container');
cont.innerHTML='';

config.forEach((item,index)=>{
const rate=rates[item.key]||{current:"0",status:"same",percent:"0%"};

const card=document.createElement('div');
card.className='card';
card.innerHTML=`
<div style="display:flex;justify-content:space-between">
<div style="font-weight:900;color:${rate.status==='up'?'var(--up)':rate.status==='down'?'var(--down)':'#aaa'}">
${rate.percent}
</div>
<div>
<b>${item.key}</b><br>
<small>${item.sub}</small>
</div>
</div>
<div class="price-val">${rate.current}</div>
<div class="chart-small"><canvas id="chart${index}"></canvas></div>
`;
cont.appendChild(card);

new Chart(document.getElementById(`chart${index}`),{
type:'line',
data:{
labels:[1,2,3,4,5,6,7],
datasets:[{
data:Array.from({length:7},()=>Math.random()*10+50),
borderColor:rate.status==='down'?'#ff453a':'#32d74b',
tension:.4,
pointRadius:0
}]
},
options:{
plugins:{legend:{display:false}},
scales:{x:{display:false},y:{display:false}}
}
});
});
}catch{
document.getElementById('main-container').innerHTML=
'<p style="text-align:center">خطا در دریافت اطلاعات</p>';
}
}

/* شروع */
window.addEventListener('DOMContentLoaded',()=>{
if(localStorage.getItem('theme')==='light')
document.body.classList.add('light-mode');

const savedView=localStorage.getItem('viewMode')||'list';

document.getElementById('dt').innerHTML=
`<b>${time}</b><div class="date-line">${j.jy}/${j.jm}/${j.jd}</div>`;
               }

load();
setInterval(load,30000);
});
</script>

</body>
</html>
